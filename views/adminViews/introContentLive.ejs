<div class="mainStyle">
  <div class="EventBody">
    <h1>Intro Content Categories</h1>
    <table style="padding:2%;background-color: rgb(22, 36, 36);">
      <thead>
        <tr>
          <th>Intro Header</th>
          <th>Image Name</th>
          <th>Description</th>
          <th>Visible</th>
          <th>Image</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% for(let i=0; i<introContent.length; i++) { %>
          <tr>
            <td><%= introContent[i].introHeader %></td>
            <form id="galleryForm_<%= i %>" action="/updateIntroContent" method="POST">
              <input type="hidden" name="introContentId" value="<%= introContent[i]._id %>">
              <td><input type="text" name="introHeader" value="<%= introContent[i].introHeader %>"></td>
              <td><input type="text" name="introDetails" value="<%= introContent[i].introDetails %>"></td>
              <td>
                <select name="visible">
                  <option value="true" <%= introContent[i].visible === true ? 'selected' : '' %>>True</option>
                  <option value="false" <%= introContent[i].visible === false ? 'selected' : '' %>>False</option>
                </select>
              </td>
              <td>
                <div class="rotateFlex">
                <img class="rotate_icon" id="rotate-left" src="/images/icons/left_rotate.png" alt="↶" onclick="rotateImage(-90)">
                <img class="tableImg" src="<%= introContent[i].imgName %>" alt="">
                <img class="rotate_icon" id="rotate-right" src="/images/icons/right_rotate.png" alt="↷" onclick="rotateImage(90)">
                 
              </div>
            </td>
                </td>
              <td><button type="submit">Save</button></td>
            </form>
            <td><button id="delete_<%= introContent[i]._id %>" type="button">Delete</button></td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<script>
function rotateImage(degrees) {
    // Make a request to the endpoint
    fetch('/rotateIntroImage', {
        method: 'POST', // or 'GET' depending on your endpoint
        body: JSON.stringify({ degrees: degrees }), // send rotation degrees to server
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        // Assuming your endpoint returns status in the response
        alert("Status: " + data.status);
    })
    .catch(error => {
        console.error('Error:', error);
        alert("Error: " + error.message);
    });
}

  // Assuming introContent is an array of objects fetched from the database
// Filter introContent to include only categories where gallery[i].visible is true
const visibleIntroContent = introContent.filter(category => category.gallery.some(image => image.visible));

// Sort the filtered array by gallery[i].rank
visibleIntroContent.sort((a, b) => {
    const rankA = a.gallery.find(image => image.visible).rank;
    const rankB = b.gallery.find(image => image.visible).rank;
    return rankA - rankB;
});

// Pass the filtered and sorted introContent to your template rendering engine
// and use it to render the HTML

  // Add event listeners to delete buttons
  document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('[id^="delete_"]');
    deleteButtons.forEach(function(button) {
      button.addEventListener('click', function(event) {
        event.preventDefault();
        const introContentId = this.id.split('_')[1]; // Retrieve introContentId from the button's dataset
        console.log(introContentId)
        const confirmation = confirm("Are you sure you want to delete this image?");
        if (confirmation) {
          // Make a request to deleteGalleryImage endpoint
          fetch('/deleteIntroContent', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({ 
                  introContentId: introContentId // Pass introContentId to the request body
              })
          })
          .then(response => {
              if (response.ok) {
                  // Reload the page after successful deletion
                  window.location.reload();
              } else {
                  console.error('Failed to delete image');
              }
          })
          .catch(error => console.error('Error:', error));
        }
      });
    });
  });
</script>

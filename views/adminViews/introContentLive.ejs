<div class="mainStyle">
  <div class="EventBody">
    <h1>Intro Content Categories</h1>
    <table style="padding:2%;background-color: rgb(22, 36, 36);">
      <thead>
        <tr>
          <th>Intro Header</th>
          <th>Image Name</th>
          <th>Description</th>
          <th>Visible</th>
          <th>Image</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% for(let i=0; i<introContent.length; i++) { %>
          <tr id="tr_<%= introContent[i]%>">
            <td><%= introContent[i].introHeader %></td>
            <form id="galleryForm_<%= i %>" action="/updateIntroContent" method="POST">
              <input type="hidden" name="introContentId" value="<%= introContent[i]._id %>">
              <td><input type="text" name="introHeader" value="<%= introContent[i].introHeader %>"></td>
              <td><input type="text" name="introDetails" value="<%= introContent[i].introDetails %>"></td>
              <td>
                <select name="visible">
                  <option value="true" <%= introContent[i].visible === true ? 'selected' : '' %>>True</option>
                  <option value="false" <%= introContent[i].visible === false ? 'selected' : '' %>>False</option>
                </select>
              </td>
              <td>
                <div class="rotateFlex">
                <img class="rotate_icon" id="rotate-left" src="/images/icons/left_rotate.png" alt="↶" onclick="rotateImage(-90)">
                <img class="tableImg" src="<%= introContent[i].imgName %>" alt="">
                <img class="rotate_icon" id="rotate-right" src="/images/icons/right_rotate.png" alt="↷" onclick="rotateImage(90)">
              </div>
            </td>
              <td><button type="submit">Save</button></td>
            </form>
            <td><button data-id="<%=introContent[i]._id%>" id="<%= introContent[i]._id %>" type="button">Delete</button></td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<script>
function rotateImage(degrees) {
    // Make a request to the endpoint
    fetch('/rotateIntroImage', {
        method: 'POST', // or 'GET' depending on your endpoint
        body: JSON.stringify({ degrees: degrees }), // send rotation degrees to server
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        // Assuming your endpoint returns status in the response
        alert("Status: " + data.status);
    })
    .catch(error => {
        console.error('Error:', error);
        alert("Error: " + error.message);
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('[data-id]');
    deleteButtons.forEach(function(button) {
        button.addEventListener('click', function(event) {
            event.preventDefault();
            const introContentId = this.getAttribute("data-id"); // Retrieve introContentId from the button's data-id attribute
            console.log(introContentId);
            const confirmation = confirm("Are you sure you want to delete this image?");
            if (confirmation) {
                // Make a request to deleteGalleryImage endpoint
                fetch('/deleteIntroContent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        id: introContentId // Pass introContentId to the request body
                    })
                })
                .then(response => {
                    if (response.ok) {
                      alert("all okay");
                      button.style.backgroundColor="red";
                      button.innerHTML='deleted';
                      button.style.color='black';
                      this.closest.tr.style.backgroundColor='grey'
                        // Reload the page after successful deletion
                       // window.location.reload();
                    } else {
                        console.error('Failed to delete image');
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        });
    });
});
</script>

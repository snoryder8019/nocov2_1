<div class="mainStyle">
  <div class="EventBody">
    <h1>Gallery Images</h1>
    <table style="padding:2%;background-color: rgb(22, 36, 36);">
      <thead>
        <tr>
          <th>Intro Header</th>
          <th>Image Name</th>
          <th>Description</th>
          <th>Visible</th>
          <th>Image</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% for(let i=0; i<introContent.length; i++) { %>
          <tr>
            <td><%= introContent[i].introHeader %></td>
            <form id="galleryForm_<%= i %>" action="/updateIntroContent" method="POST">
              <input type="hidden" name="introContentId" value="<%= introContent[i]._id %>">
              <td><input type="text" name="introHeader" value="<%= introContent[i].introHeader %>"></td>
              <td><input type="text" name="introDetails" value="<%= introContent[i].introDetails %>"></td>
              <td>
                <select name="visible">
                  <option value="true" <%= introContent[i].visible === true ? 'selected' : '' %>>True</option>
                  <option value="false" <%= introContent[i].visible === false ? 'selected' : '' %>>False</option>
                </select>
              </td>
              <td><img style="width: 50px;" src="<%= introContent[i].imgName %>" alt=""></td>
              <td><button type="submit">Save</button></td>
            </form>
            <td><button id="delete_<%= introContent[i]._id %>" type="button">Delete</button></td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<script>
  // Add event listeners to delete buttons
  document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('[id^="delete_"]');
    deleteButtons.forEach(function(button) {
      button.addEventListener('click', function(event) {
        event.preventDefault();
        const introContentId = this.id.split('_')[1]; // Retrieve introContentId from the button's dataset
        console.log(introContentId)
        const confirmation = confirm("Are you sure you want to delete this image?");
        if (confirmation) {
          // Make a request to deleteGalleryImage endpoint
          fetch('/deleteIntroContent', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({ 
                  introContentId: introContentId // Pass introContentId to the request body
              })
          })
          .then(response => {
              if (response.ok) {
                  // Reload the page after successful deletion
                  window.location.reload();
              } else {
                  console.error('Failed to delete image');
              }
          })
          .catch(error => console.error('Error:', error));
        }
      });
    });
  });
</script>

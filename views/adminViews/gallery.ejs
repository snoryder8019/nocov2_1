<div class="mainStyle">
    <div class="EventBody">
        <h1>Gallery Images</h1>
        <table style="padding:2%;background-color: rgb(22, 36, 36);">
            <thead>
                <tr>
                    <th>Intro Header</th>
                    <th>Image Name</th>
                    <th>Description</th>
                    <th>Visible</th>
                    <th>Image</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <% for(let i=0; i<introContent.length; i++) { %>
                    <% for(let x=0; x<introContent[i].gallery.length; x++) { %>
                        <tr>
                            <% if(x === 0) { %>
                                <td rowspan="<%= introContent[i].gallery.length %>"><%= introContent[i].introHeader %></td>
                                <% } %>
                                <form id="galleryForm" action="/updateGalleryImage" method="POST">
                                    <input type="hidden"name="introContentId" value="<%=introContent[i]._id%>">
                                    <input type="hidden"name="galleryIndex" value="<%=x%>">
                        <td><input type="text" name="galleryImgName" value="<%= introContent[i].gallery[x].galleryImgName %>"></td>
                        <td><input type="text" name="galleryImgDesc" value="<%= introContent[i].gallery[x].galleryImgDesc %>"></td>
                        <td>
                            <select name="visible">
                                <option value="true" <%= introContent[i].gallery[x].visible === true ? 'selected' : '' %>>True</option>
                                <option value="false" <%= introContent[i].gallery[x].visible === false ? 'selected' : '' %>>False</option>
                            </select>
                        </td>
                        <td><img style="width: 50px;" src="<%= introContent[i].gallery[x].imageUrl %>" alt=""></td>
                        <td><button type="submit">Save</button></td>
                    </form>
                        <td><button  id="delete_<%= x %>_<%=introContent[i]._id%>" type="button">Delete</button></td>
                    </tr>
                    <% } %>
                    <% } %>
                </tbody>
            </table>
    </div>
</div>

<script>
    // Add event listeners to delete buttons
    document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('[id^="delete_"]');
    deleteButtons.forEach(function(button) {
        button.addEventListener('click', function(event) {
            event.preventDefault();
            const galleryIndex = this.id.split('_')[1];
            const introContentId = this.id.split('_')[2]; // Retrieve introContentId from the button's dataset
            console.log(introContentId)
            const confirmation = confirm("Are you sure you want to delete this image?");
            if (confirmation) {
                // Make a request to deleteGalleryImage endpoint
                fetch('/deleteGalleryImage', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        galleryIndex: galleryIndex, 
                        introContentId: introContentId // Pass introContentId to the request body
                    })
                })
                .then(response => {
                    if (response.ok) {
                        // Reload the page after successful deletion
                        window.location.reload();
                    } else {
                        console.error('Failed to delete image');
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        });
    });
});

</script>
